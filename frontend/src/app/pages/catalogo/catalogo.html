<section class="hero-bleed">
  <div class="hero-inner" style="display:flex; justify-content:flex-end; align-items:center;">
    <div class="hero-ctas flex items-center gap-3">
      <button mat-flat-button color="primary" class="rounded-xl cta-user" (click)="goToUserMenu()">
        <mat-icon class="mr-2">login</mat-icon> Ingresar / Mi cuenta
      </button>
      <button mat-icon-button class="rounded-xl border border-slate-200" (click)="cart.open()" aria-label="Abrir carrito">
        <mat-icon>shopping_cart</mat-icon>
      </button>
    </div>
  </div>
</section>

<nav class="sticky top-0 z-40 bg-white/90 backdrop-blur border-b border-slate-100 relative">

  <div class="nav-actions-abs">


    <!-- Precio -->
    <h4 class="font-medium mr-4 text-slate-700">Precio</h4>
    <div class="filter-row">
      <div class="filter-input">
        <div class="flex gap-2">
          
            <mat-form-field appearance="outline" floatLabel="always" class="ff-slim" [style.width.px]="112">
            <mat-label>Min</mat-label>
            <input matInput type="number" [formControl]="form.controls.precioMin" (keyup.enter)="pageIndex.set(0)" />
          </mat-form-field>




          <mat-form-field appearance="outline" floatLabel="always" class="ff-slim"  [style.width.px]="112" >
            <mat-label>Max</mat-label>
            <input matInput type="number" [formControl]="form.controls.precioMax" (keyup.enter)="pageIndex.set(0)" />
          </mat-form-field>
        </div>
      </div>
    </div>


    <h4 class="font-medium mr-4 text-slate-700">Buscar producto</h4>

    <div class="filter-row">

      <div class="filter-input">


        <mat-form-field appearance="outline"  floatLabel="always" class="ff-slim" style="width:200px">
          <input matInput placeholder="Nombre o descripción" [formControl]="form.controls.q"
            (keyup.enter)="pageIndex.set(0)" />
          <button *ngIf="form.controls.q.value" mat-icon-button matSuffix class="clear-btn" (click)="clearQ()"
            aria-label="Limpiar">
            <mat-icon>close</mat-icon>
          </button>
        </mat-form-field>
      </div>
    </div>

    <h4 class="font-medium mr-4 text-slate-700">Ordenar por</h4>
    <mat-button-toggle-group [value]="formSig().sort" (change)="setSort($event.value)">
      <mat-button-toggle value="recientes">Recientes</mat-button-toggle>
      <mat-button-toggle value="precio-asc">Precio ↑</mat-button-toggle>
      <mat-button-toggle value="precio-desc">Precio ↓</mat-button-toggle>
      <mat-button-toggle value="relevancia">Relevancia</mat-button-toggle>
    </mat-button-toggle-group>

  </div>
</nav>

<!--
  Se elimina la clase pt-8 y se aplica el padding superior
  directamente con un estilo en línea para forzar el cambio.
-->
<div class="min-h-screen" style="padding-top: 5.5rem;">
  <!--
    Contenedor principal de 2 columnas.
    Se eliminó el padding superior de este div (py-8 -> px-4 pb-8) ya que se maneja en el padre.
  -->
  <div class="max-w-7xl mx-auto px-4 pb-8" style="display: flex; flex-direction: row; gap: 2rem;">

    <!--
      COLUMNA IZQUIERDA: FILTROS
      Se añaden estilos en línea para definir el ancho.
    -->
    <aside style="width: 288px; flex-shrink: 0;">
      <div class="p-4 rounded-2xl border border-slate-200 bg-white sticky top-24">

        <!-- Menú unificado -->
        <div class="flex flex-col items-start">
          <button class="filter-btn">
            <mat-icon class="mr-2">camera_alt</mat-icon> Mídete tus gafas
          </button>
          <button class="filter-btn">
            <mat-icon class="mr-2">local_shipping</mat-icon> Sigue tu envío
          </button>
        </div>

        <mat-divider class="my-4"></mat-divider>

        <!-- Se eliminó el título "Filtros" para unificar el menú -->

        <!-- Buscador -->


        <!-- Categorías -->
        <h4 class="font-medium mt-6 mb-2 text-slate-700">Categorías</h4>
        <!-- Contenedor para hacer la lista de categorías desplazable -->
        <div style="max-height: 250px; overflow-y: auto; padding-right: 8px;">
          <div class="flex flex-col items-start">
            <button class="filter-btn" [class.active]="formSig().tipo==='todos'"
              (click)="selectTipo('todos')">Todas</button>
            <button class="filter-btn" *ngFor="let t of tipos()" [class.active]="formSig().tipo===t"
              (click)="selectTipo(t)">
              {{ t }}
            </button>
          </div>
        </div>


      </div>
    </aside>

    <!-- COLUMNA DERECHA: CONTENIDO PRINCIPAL -->
    <main style="flex: 1;">


      <!-- Chips de filtros activos -->
      <div class="mb-4" *ngIf="chips().length">
        <mat-chip-listbox>
          <mat-chip-option *ngFor="let c of chips()" (removed)="clearChip(c.key)" removable>
            {{ c.label }}
            <button matChipRemove aria-label="Quitar">
              <mat-icon>cancel</mat-icon>
            </button>
          </mat-chip-option>
        </mat-chip-listbox>
      </div>

      <!-- Contenido de la cuadrícula de productos -->
      <ng-container *ngIf="!error(); else errorTpl">



        <ng-container *ngIf="!cargando(); else skeletonTpl">
          <div *ngIf="length; else emptyTpl" class="products-grid">
            <article *ngFor="let p of pageItems()" class="product-card">
              <div class="product-image">
                <img [src]="img(p.uid) || 'assets/placeholder-product.svg'" [alt]="p.nombre" loading="lazy" />
                <div class="badge-tipo" *ngIf="p.tipo">{{ p.tipo }}</div>
                <div class="price-sticker">{{ p.precio | currency:'COP':'symbol-narrow':'1.0-0' }}</div>
              </div>
              <div class="product-info">
                <h3 class="name line-clamp-2">{{ p.nombre }}</h3>
                <p class="desc line-clamp-2">{{ p.descripcion || '—' }}</p>
                <div class="actions">
                  <button mat-mini-fab color="primary" aria-label="Agregar al carrito" (click)="addToCart(p)">
                    <mat-icon>add_shopping_cart</mat-icon>
                  </button>
                </div>
              </div>
            </article>
          </div>

          <div class="mt-6 flex justify-center">
            <mat-paginator [length]="length" [pageIndex]="pageIndex()" [pageSize]="pageSize()"
              [pageSizeOptions]="[8, 12, 24, 48]" (page)="onPage($event)">
            </mat-paginator>
          </div>
        </ng-container>
      </ng-container>

      <!-- Templates -->
      <ng-template #skeletonTpl>
        <div class="products-grid">
          <div *ngFor="let i of [0,1,2,3,4,5,6,7,8,9,10,11]" class="product-card skeleton">
            <div class="product-image"></div>
            <div class="product-info">
              <div class="skeleton-line w-3/4"></div>
              <div class="skeleton-line w-1/2"></div>
            </div>
          </div>
        </div>
      </ng-template>
      <ng-template #emptyTpl>
        <div class="text-center py-20 bg-white rounded-2xl border border-slate-200">
          <mat-icon class="text-5xl mb-2">inventory_2</mat-icon>
          <p class="text-slate-600">No encontramos productos con los filtros actuales.</p>
        </div>
      </ng-template>
      <ng-template #errorTpl>
        <div class="bg-red-50 border border-red-200 text-red-700 p-4 rounded-xl">
          {{ error() }}
        </div>
      </ng-template>
    </main>

  </div>
</div>
<app-mini-checkout></app-mini-checkout>
